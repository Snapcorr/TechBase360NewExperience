// Three.js Scene Setup
function initWebGL() {
    const container = document.getElementById('webgl-container');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);
    
    // Industrial-style geometry
    const geometry = new THREE.BoxGeometry(10, 10, 10);
    const edges = new THREE.EdgesGeometry(geometry);
    const line = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0x555555 })
    );
    scene.add(line);
    
    // Add multiple industrial elements
    for (let i = 0; i < 20; i++) {
        const box = new THREE.Mesh(
            new THREE.BoxGeometry(1, Math.random() * 3 + 1, 1),
            new THREE.MeshBasicMaterial({ 
                color: 0x333333,
                wireframe: true
            })
        );
        box.position.x = (Math.random() - 0.5) * 20;
        box.position.y = (Math.random() - 0.5) * 10;
        box.position.z = (Math.random() - 0.5) * 20;
        scene.add(box);
    }
    
    camera.position.z = 15;
    
    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        line.rotation.x += 0.001;
        line.rotation.y += 0.002;
        renderer.render(scene, camera);
    }
    
    animate();
    
    // Handle resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

// Lottie Animations
function initLottieAnimations() {
    // Production icon animation
    const productionAnim = lottie.loadAnimation({
        container: document.getElementById('production-icon'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'animations/production.json'
    });
    
    // Service icon animation
    const serviceAnim = lottie.loadAnimation({
        container: document.getElementById('service-icon'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'animations/service.json'
    });
    
    // Assembly icon animation
    const assemblyAnim = lottie.loadAnimation({
        container: document.getElementById('assembly-icon'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'animations/assembly.json'
    });
}

// GSAP Animations
function initScrollAnimations() {
    // Animate sections on scroll
    gsap.utils.toArray('section').forEach(section => {
        gsap.from(section, {
            opacity: 0,
            y: 50,
            duration: 1,
            scrollTrigger: {
                trigger: section,
                start: 'top 80%',
                toggleActions: 'play none none none'
            }
        });
    });
    
    // Animate energy meter fill
    gsap.to('.meter-fill', {
        width: '100%',
        scrollTrigger: {
            trigger: '.energy-widget',
            start: 'top 80%',
            end: 'top 20%',
            scrub: 1
        }
    });
    
    // Animate node connections
    gsap.from('.connection-line', {
        strokeDashoffset: 1000,
        duration: 2,
        ease: 'power2.inOut',
        scrollTrigger: {
            trigger: '.ecosystem-map',
            start: 'top 80%'
        }
    });
}

// Smooth scrolling for navigation
function initSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    initWebGL();
    initLottieAnimations();
    initScrollAnimations();
    initSmoothScrolling();
    
    // Animate hero title
    gsap.from('.title-line', {
        y: 50,
        opacity: 0,
        stagger: 0.2,
        duration: 1,
        ease: 'power3.out'
    });
    
    // Animate hero subtitle
    gsap.from('.hero-subtitle', {
        y: 30,
        opacity: 0,
        delay: 0.6,
        duration: 0.8,
        ease: 'power2.out'
    });
    
    // Animate scroll indicator
    gsap.from('.scroll-line', {
        scaleY: 0,
        transformOrigin: 'top',
        delay: 1.2,
        duration: 1,
        ease: 'power2.out'
    });
});
